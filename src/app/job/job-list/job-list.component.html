<ng-container *ngIf="jobs$ | async; else loading">
  <div class="overflow-auto w-full">
    <table class="table table-zebra">
      <thead>
        <tr>
          <th>
            <button
              (mouseenter)="sortIconShowMap.jobTitle = true"
              (mouseleave)="sortIconShowMap.jobTitle = false"
              (click)="sortJobs('name')"
              class="btn btn-ghost w-full flex items-center justify-between flex-nowrap"
            >
              <span>Título</span>
              <i
                *ngIf="sortIconShowMap.jobTitle"
                class="bx"
                [ngClass]="{
                  'bx-sort-up': sortOrder == 'asc',
                  'bx-sort-down': sortOrder == 'desc'
                }"
              ></i>
            </button>
          </th>
          <th>
            <button
              (mouseenter)="sortIconShowMap.companyName = true"
              (mouseleave)="sortIconShowMap.companyName = false"
              (click)="sortJobs('careerPageName')"
              class="btn btn-ghost w-full flex items-center justify-between flex-nowrap"
            >
              <span>Empresa</span>
              <i
                *ngIf="sortIconShowMap.companyName"
                class="bx"
                [ngClass]="{
                  'bx-sort-up': sortOrder == 'asc',
                  'bx-sort-down': sortOrder == 'desc'
                }"
              ></i>
            </button>
          </th>
          <th>
            <button
              (mouseenter)="sortIconShowMap.experienceLevel = true"
              (mouseleave)="sortIconShowMap.experienceLevel = false"
              (click)="sortJobs('experienceLevel')"
              class="btn btn-ghost w-full flex items-center justify-between flex-nowrap"
            >
              <span>Nível de experiência</span>
              <i
                *ngIf="sortIconShowMap.experienceLevel"
                class="bx"
                [ngClass]="{
                  'bx-sort-up': sortOrder == 'asc',
                  'bx-sort-down': sortOrder == 'desc'
                }"
              ></i>
            </button>
          </th>
          <th>
            <button
              (mouseenter)="sortIconShowMap.workplaceType = true"
              (mouseleave)="sortIconShowMap.workplaceType = false"
              (click)="sortJobs('workplaceType')"
              class="btn btn-ghost w-full flex items-center justify-between flex-nowrap"
            >
              <span>Modalidade</span>
              <i
                *ngIf="sortIconShowMap.workplaceType"
                class="bx"
                [ngClass]="{
                  'bx-sort-up': sortOrder == 'asc',
                  'bx-sort-down': sortOrder == 'desc'
                }"
              ></i>
            </button>
          </th>
          <th>
            <button
              (mouseenter)="sortIconShowMap.jobLocation = true"
              (mouseleave)="sortIconShowMap.jobLocation = false"
              (click)="sortJobs('city')"
              class="btn btn-ghost w-full flex items-center justify-between flex-nowrap"
            >
              <span>Local</span>
              <i
                *ngIf="sortIconShowMap.jobLocation"
                class="bx"
                [ngClass]="{
                  'bx-sort-up': sortOrder == 'asc',
                  'bx-sort-down': sortOrder == 'desc'
                }"
              ></i>
            </button>
          </th>
          <th>
            <button
              (mouseenter)="sortIconShowMap.jobType = true"
              (mouseleave)="sortIconShowMap.jobType = false"
              (click)="sortJobs('type')"
              class="btn btn-ghost w-full flex items-center justify-between flex-nowrap"
            >
              <span>Tipo</span>
              <i
                *ngIf="sortIconShowMap.jobType"
                class="bx"
                [ngClass]="{
                  'bx-sort-up': sortOrder == 'asc',
                  'bx-sort-down': sortOrder == 'desc'
                }"
              ></i>
            </button>
          </th>
          <th>
            <button
              (mouseenter)="sortIconShowMap.publishedDate = true"
              (mouseleave)="sortIconShowMap.publishedDate = false"
              (click)="sortJobs('publishedDate')"
              class="btn btn-ghost w-full flex items-center justify-between flex-nowrap"
            >
              <span>Data de publicação</span>
              <i
                *ngIf="sortIconShowMap.publishedDate"
                class="bx"
                [ngClass]="{
                  'bx-sort-up': sortOrder == 'asc',
                  'bx-sort-down': sortOrder == 'desc'
                }"
              ></i>
            </button>
          </th>
          <th>
            <button
              (mouseenter)="sortIconShowMap.acceptsDisabledPersons = true"
              (mouseleave)="sortIconShowMap.acceptsDisabledPersons = false"
              (click)="sortJobs('disabilities')"
              class="btn btn-ghost w-full flex items-center justify-between flex-nowrap"
            >
              <span>PCD</span>
              <i
                *ngIf="sortIconShowMap.acceptsDisabledPersons"
                class="bx"
                [ngClass]="{
                  'bx-sort-up': sortOrder == 'asc',
                  'bx-sort-down': sortOrder == 'desc'
                }"
              ></i>
            </button>
          </th>
          <th>Link</th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>
            <input
              [(ngModel)]="filters.jobTitle"
              (ngModelChange)="filterJobs()"
              id="jobTitle"
              name="jobTitle"
              type="text"
              class="input input-bordered input-sm w-full max-w-xs"
            />
          </td>

          <td>
            <input
              [(ngModel)]="filters.companyName"
              (ngModelChange)="filterJobs()"
              id="companyName"
              name="companyName"
              type="text"
              class="input input-bordered input-sm w-full max-w-xs"
            />
          </td>

          <td>
            <select
              [(ngModel)]="filters.experienceLevel"
              (ngModelChange)="filterJobs()"
              id="experienceLevel"
              name="experienceLevel"
              class="select select-bordered select-sm w-full max-w-xs"
            >
              <option value=""></option>
              <option
                *ngFor="let experienceLevel of experienceLevels | keyvalue"
              >
                {{ experienceLevel.value }}
              </option>
            </select>
          </td>

          <td>
            <select
              [(ngModel)]="filters.workplaceType"
              (ngModelChange)="filterJobs()"
              id="workplaceType"
              name="workplaceType"
              class="select select-bordered select-sm w-full max-w-xs"
            >
              <option selected></option>
              <option value="remoto">Remoto</option>
              <option value="híbrido">Híbrido</option>
              <option value="presencial">Presencial</option>
            </select>
          </td>

          <td>
            <input
              [(ngModel)]="filters.jobLocation"
              (ngModelChange)="filterJobs()"
              id="jobLocation"
              name="jobLocation"
              type="text"
              class="input input-bordered input-sm w-full max-w-xs"
            />
          </td>

          <td>
            <select
              [(ngModel)]="filters.jobType"
              (ngModelChange)="filterJobs()"
              id="jobType"
              name="jobType"
              class="select select-bordered select-sm w-full max-w-xs"
            >
              <option selected></option>
              <option
                *ngFor="let typeTranslation of typeTranslations | keyvalue"
                [value]="typeTranslation.key"
              >
                {{ typeTranslation.value | titlecase }}
              </option>
            </select>
          </td>

          <td>
            <input
              [(ngModel)]="filters.publishedDate"
              (ngModelChange)="filterJobs()"
              id="publishedDate"
              name="publishedDate"
              type="date"
              class="input input-bordered input-sm w-full max-w-xs"
              [max]="inputMaxDate"
            />
          </td>

          <td>
            <select
              [(ngModel)]="filters.acceptsDisabledPersons"
              (ngModelChange)="filterJobs()"
              id="acceptsDisabledPersons"
              name="acceptsDisabledPersons"
              class="select select-bordered select-sm w-full max-w-xs"
            >
              <option [value]="undefined" selected></option>
              <option [value]="true">Sim</option>
              <option [value]="false">Não</option>
            </select>
          </td>
        </tr>

        <tr class="hover" *ngFor="let job of filteredJobs">
          <td>
            {{ job.name }}
          </td>

          <td>
            <a class="link" [href]="job.careerPageUrl">{{
              job.careerPageName
            }}</a>
          </td>

          <td>{{ job.experienceLevel }}</td>

          <td>{{ job.workplaceType | titlecase }}</td>

          <td>
            {{
              job.city
                ? job.city + ", " + (job.state | stateAbbreviation)
                : "N/A"
            }}
          </td>

          <td>{{ typeTranslations[job.type] | titlecase }}</td>

          <td>{{ job.publishedDate | date : "dd/MM/yyyy" }}</td>

          <td>
            <i
              class="bx"
              [ngClass]="{
                'bx-check': job.disabilities,
                'bx-x': !job.disabilities || false
              }"
            ></i>
          </td>

          <td>
            <a [href]="job.jobUrl" target="_blank">
              <i class="bx bx-link-external"></i>
            </a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</ng-container>

<ng-template #loading>
  <div class="flex flex-col w-full gap-4 mt-4">
    <div class="skeleton h-8 w-full"></div>
    <div class="skeleton h-8 w-full"></div>
    <div class="skeleton h-8 w-full"></div>
    <div class="skeleton h-8 w-full"></div>
    <div class="skeleton h-8 w-full"></div>
  </div>
</ng-template>
